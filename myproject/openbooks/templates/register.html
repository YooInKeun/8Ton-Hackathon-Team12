{% extends 'base.html' %}

{% load staticfiles %}

{% block extra-style %}
<style>
</style>
{% endblock extra-style %}

{% block navbar %}
{% include 'navbar.html' %}
{% endblock %}

{% block content %}
<div onload="initTmap()">
    <div class = "container">
        <h1 style="color : cornflowerblue">도서 등록</h1><br>
        <form action = "{% url 'openbooks:create' %}">
            <h4>제목</h4>
            <input type = "text" name = "title">
            <br>
            <br>
            <h4>상태</h4>
            <textarea cols = 40 rows = 2 name = "summary"></textarea>
            <br>
            <br>
            <h4>기부 여부</h4>
            <input type="radio" name="availability" value="True">기부
            <input type="radio" name="availability" value="True">빌려줌
            <br>
            <br>
            <h4>위치 지정</h4>
            <p id="result">ㅇㅇ</p>
            <div>
                <div id="map_div">
                </div>        
            </div>
            <input class = "btn btn-dark" type = "submit" value = "등록하기">  
        </form>
    </div>

    <br>
    <br>
    <h2>내가 등록한 책들</h2>
    
    {% for book in books %}

    <div style="border:1px solid darkslategrey; border-radius:12px; border-color:black;
                margin-left : 30px ; margin-top:10px; padding:25px">
    
    <h1 style = "color:cornflowerblue">책 고유 Code: {{book.id}}</h1>
    <p>제목: {{book.book}}}</p>
    <p>상태: {{book.summary}}</p>
    <p>빌려줬는지:{{book.rent_availability}}</p>
    <p>기부했는지:{{book.donate_availability}}</p>
    <hr>
    
    </div>
    
    {% endfor %}
</div>

{% endblock content %}

{% block footer %}
{% endblock footer %}

{% block extra-script %}
<!-- Bootstrap core JavaScript -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>simpleMap</title>
<script src="https://apis.openapi.sk.com/tmap/js?version=1&format=javascript&appKey=25b2aaf5-3168-4b66-afbe-732bc6568077"></script>
<script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    axios.defaults.xsrfCookieName = "csrftoken";
    axios.defaults.xsrfHeaderName = "X-CSRFToken";
</script>
<script>
    var map;
    // 페이지가 로딩이 된 후 호출하는 함수입니다.
    function initTmap(){
        //map 생성
        // Tmap.map을 이용하여, 지도가 들어갈 div, 넓이, 높이를 설정합니다.
        map = new Tmap.Map({div:'map_div', // map을 표시해줄 div
                            width:'100%',  // map의 width 설정
                            height:'400px' // map의 height 설정
        }); 
                        
        //map 클릭 이벤트 등록
        map.events.addEventType("touchstart"); 	                    
        map.events.register("click", map, onClick);
        
    }     
    // 지도를 클릭했을때 발생하는 이벤트 함수입니다.
    
    function onClick(e){
        console.log("??")
        var lonlat = map.getLonLatFromViewPortPx(e.xy).transform("EPSG:3857", "EPSG:4326");//클릭한 부분의 ViewPorPx를 LonLat로 변환합니다
        var result ='클릭한 위치의 좌표는'+lonlat+'입니다.';
        var resultDiv = document.getElementById("result");
        resultDiv.innerHTML = result;
        console.log(lonlat);

        axios.post('/post', {
            lon: lonlat.lon,
            lat: lonlat.lat
        })
        .then(function (response) {
            console.log(response);
            console.log('success');
        })
        .catch(function (error) {
            console.log(error);
        });
    }
    // 맵 생성 실행
    initTmap();
    </script>
<script>
    $(function () {
        $('[data-toggle=tooltip]').tooltip();
    });
</script>
{% endblock extra-script %}